<template>
    <lightning-card title="Recherche de Propri√©t√©s" icon-name="standard:address">
        <div class="slds-p-around_medium">
            
            <!-- S√©lection de municipalit√© -->
            <div class="slds-form-element slds-m-bottom_medium">
                <label class="slds-form-element__label" for="municipality-select">
                    <abbr class="slds-required" title="required">*</abbr>
                    Municipalit√©
                </label>
                <div class="slds-form-element__control">
                    <lightning-combobox
                        id="municipality-select"
                        name="municipality"
                        label=""
                        value={selectedMunicipality}
                        placeholder="S√©lectionner une municipalit√©"
                        options={municipalityOptions}
                        onchange={handleMunicipalityChange}
                        disabled={isLoadingMunicipalities}>
                    </lightning-combobox>
                    
                    <!-- Indicateur de chargement -->
                    <template if:true={isLoadingMunicipalities}>
                        <lightning-spinner alternative-text="Chargement des municipalit√©s..." size="small"></lightning-spinner>
                    </template>
                </div>
            </div>
            
            <!-- Recherche de rue -->
            <div class="slds-form-element slds-m-bottom_medium">
                <label class="slds-form-element__label" for="street-input">
                    <abbr class="slds-required" title="required">*</abbr>
                    Voie publique
                </label>
                <div class="slds-form-element__control">
                    <div class="slds-input-has-icon slds-input-has-icon_right">
                        <lightning-input
                            id="street-input"
                            type="text"
                            label=""
                            placeholder="Tapez le nom de la rue (ex: SAINT)"
                            value={streetInput}
                            onchange={handleStreetInput}
                            class={streetInputClass}
                            disabled={isLoadingStreets}>
                        </lightning-input>
                        
                        <!-- Indicateur de chargement -->
                        <template if:true={isLoadingStreets}>
                            <lightning-spinner alternative-text="Recherche en cours..." size="small"></lightning-spinner>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Suggestions de rues -->
            <template if:true={showStreetSuggestions}>
                <div class={streetSuggestionsClass}>
                    <ul class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid">
                        <template for:each={streetSuggestions} for:item="street">
                            <li key={street} class="slds-dropdown__item">
                                <a 
                                    class="slds-dropdown__item-action slds-truncate" 
                                    data-value={street}
                                    onclick={handleStreetSelection}
                                    title={street}>
                                    <lightning-icon 
                                        icon-name="standard:address" 
                                        size="x-small" 
                                        class="slds-m-right_x-small">
                                    </lightning-icon>
                                    {street}
                                </a>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
            
            <!-- Recherche de num√©ro -->
            <div class="slds-form-element slds-m-bottom_medium">
                <label class="slds-form-element__label" for="number-input">
                    <abbr class="slds-required" title="required">*</abbr>
                    Num√©ro civique
                </label>
                <div class="slds-form-element__control">
                    <lightning-input
                        id="number-input"
                        type="text"
                        label=""
                        placeholder="Saisissez le num√©ro civique"
                        value={numberInput}
                        onchange={handleNumberInput}
                        class={numberInputClass}
                        disabled={isNumberDisabled}>
                    </lightning-input>
                </div>
            </div>
            
            <!-- Bouton de recherche -->
            <div class="slds-form-element slds-m-bottom_medium">
                <lightning-button
                    label="Rechercher"
                    onclick={handleSearch}
                    disabled={searchDisabled}
                    variant="brand"
                    class="slds-m-top_small">
                </lightning-button>
            </div>
            
            <!-- Rue s√©lectionn√©e -->
            <template if:true={selectedStreet}>
                <div class="slds-m-top_small">
                    <lightning-badge label="Rue s√©lectionn√©e" variant="success"></lightning-badge>
                    <span class="slds-m-left_small">{selectedStreet}</span>
                </div>
            </template>
            
            <!-- Zone de r√©sultats -->
            <div class="slds-m-top_medium">
                
                <!-- Loading -->
                <template if:true={isLoadingProperty}>
                    <div class="slds-text-align_center">
                        <lightning-spinner size="small" alternative-text="Recherche de propri√©t√© en cours..."></lightning-spinner>
                        <p>Recherche en cours...</p>
                    </div>
                </template>
                
                <!-- Propri√©t√© trouv√©e -->
                <template if:true={showPropertyDetails}>
                    <div class="slds-box slds-theme_default">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">
                            üè† {propertyAddress}
                        </h3>
                        
                        <!-- Accord√©ons pour les sections du r√¥le d'√©valuation -->
                        <lightning-accordion allow-multiple-sections-open class="property-details-accordion">
                            
                            <!-- En-t√™te du r√¥le -->
                            <lightning-accordion-section name="header" label="üìã En-t√™te du r√¥le">
                                <div class="slds-grid slds-wrap slds-gutters">
                                    <div class="slds-col slds-size_1-of-2">
                                        <p><strong>Code g√©ographique :</strong> {propertyDetails.RLM01A}</p>
                                        <p><strong>Mill√©sime :</strong> {propertyDetails.RLM02A}</p>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <p><strong>Version :</strong> {propertyDetails.VERSION}</p>
                                    </div>
                                </div>
                            </lightning-accordion-section>
                            
                            <!-- Section 1 : Identification de l'unit√© d'√©valuation -->
                            <lightning-accordion-section name="identification" label="üìç Section 1 : Identification de l'unit√© d'√©valuation">
                                
                                <!-- Groupe Adresse (RL0101) -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè† Groupe Adresse (RL0101)</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Num√©ro inf√©rieur :</strong> {rl0101Ax}</p>
                                            <p><strong>Fraction num√©ro inf√©rieur :</strong> {rl0101Bx}</p>
                                            <p><strong>Num√©ro sup√©rieur :</strong> {rl0101Cx}</p>
                                            <p><strong>Fraction num√©ro sup√©rieur :</strong> {rl0101Dx}</p>
                                            <p><strong>Code g√©n√©rique (type rue) :</strong> {rl0101Ex}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Code de lien :</strong> {rl0101Fx}</p>
                                            <p><strong>Nom voie publique :</strong> {rl0101Gx}</p>
                                            <p><strong>Point cardinal :</strong> {rl0101Hx}</p>
                                            <p><strong>Num√©ro appartement/local :</strong> {rl0101Ix}</p>
                                            <p><strong>Partie compl√©mentaire :</strong> {rl0101Jx}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Arrondissement (RL0102) -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üèòÔ∏è Groupe Arrondissement (RL0102)</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Num√©ro arrondissement :</strong> {rl0102A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Cadastre (RL0103) -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üó∫Ô∏è Groupe Cadastre (RL0103)</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Lot cadastre r√©nov√© :</strong> {rl0103Ax}</p>
                                            <p><strong>Suffixe lot r√©nov√© :</strong> {rl0103Bx}</p>
                                            <p><strong>Cadastre non r√©nov√© :</strong> {rl0103Cx}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>D√©signation secondaire :</strong> {rl0103Dx}</p>
                                            <p><strong>Lot non r√©nov√© :</strong> {rl0103Ex}</p>
                                            <p><strong>Partie non subdivis√©e :</strong> {rl0103Fx}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Matricule (RL0104) -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üî¢ Groupe Matricule (RL0104)</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Division :</strong> {rl0104A}</p>
                                            <p><strong>Section :</strong> {rl0104B}</p>
                                            <p><strong>Emplacement :</strong> {rl0104C}</p>
                                            <p><strong>Chiffre autov√©rificateur :</strong> {rl0104D}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Num√©ro b√¢timent :</strong> {rl0104E}</p>
                                            <p><strong>Num√©ro local :</strong> {rl0104F}</p>
                                            <p><strong>Fuseau :</strong> {rl0104G}</p>
                                            <p><strong>Discriminant :</strong> {rl0104H}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Codes (RL0105-RL0107) -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìã Groupe Codes (RL0105-RL0107)</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Code utilisation :</strong> {rl0105A}</p>
                                            <p><strong>Num√©ro dossier :</strong> {rl0106A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Unit√© voisinage :</strong> {rl0107A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Section 2 : Identification du propri√©taire -->
                            <lightning-accordion-section name="owner" label="üë§ Section 2 : Identification du propri√©taire">
                                
                                <!-- Groupe Identit√© du propri√©taire -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üë§ Groupe Identit√© du propri√©taire</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nom l√©gal du propri√©taire :</strong> {rl0201Ax}</p>
                                            <p><strong>Pr√©nom du propri√©taire :</strong> {rl0201Bx}</p>
                                            <p><strong>Compl√©ment d'adresse/contact :</strong> {rl0201Fx}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Date initiale d'inscription :</strong> {rl0201Gx}</p>
                                            <p><strong>Statut imposition scolaire :</strong> {rl0201Hx}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Adresse postale principale -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìÆ Groupe Adresse postale principale</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Adresse postale non structur√©e :</strong> {rl0201Cx}</p>
                                            <p><strong>Municipalit√© :</strong> {rl0201Dx}</p>
                                            <p><strong>Code postal :</strong> {rl0201Ex}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Province/√©tat :</strong> {rl0201Qx}</p>
                                            <p><strong>Pays :</strong> {rl0201Rx}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Adresse postale structur√©e -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè† Groupe Adresse postale structur√©e</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Num√©ro civique :</strong> {rl0201Ix}</p>
                                            <p><strong>Fraction num√©ro civique :</strong> {rl0201Jx}</p>
                                            <p><strong>Code g√©n√©rique (type rue) :</strong> {rl0201Kx}</p>
                                            <p><strong>Code de lien :</strong> {rl0201Lx}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nom voie publique :</strong> {rl0201Mx}</p>
                                            <p><strong>Point cardinal :</strong> {rl0201Nx}</p>
                                            <p><strong>Num√©ro appartement/local :</strong> {rl0201Ox}</p>
                                            <p><strong>Fraction appartement/local :</strong> {rl0201Px}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Informations postales -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üì¨ Groupe Informations postales</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Case postale :</strong> {rl0201Sx}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Succursale postale :</strong> {rl0201Tx}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Code administratif -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìã Groupe Code administratif</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Code conditions d'inscription :</strong> {rl0201U}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Section 3 : Caract√©ristiques de l'unit√© d'√©valuation -->
                            <lightning-accordion-section name="land" label="üåç Section 3 : Caract√©ristiques de l'unit√© d'√©valuation">
                                
                                <!-- Groupe Caract√©ristiques du terrain -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üå± Groupe Caract√©ristiques du terrain</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Dimension lin√©aire/mesure frontale :</strong> {rl0301A}</p>
                                            <p><strong>Superficie du terrain :</strong> {rl0302A}</p>
                                            <p><strong>Code zonage agricole :</strong> {rl0303A}</p>
                                            <p><strong>Superficie exploitation agricole totale :</strong> {rl0304A}</p>
                                            <p><strong>Superficie exploitation agricole en zone :</strong> {rl0305A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Superficie imposition maximale :</strong> {rl0314A}</p>
                                            <p><strong>Superficie vocation foresti√®re totale :</strong> {rl0315A}</p>
                                            <p><strong>Superficie vocation foresti√®re en zone agricole :</strong> {rl0316A}</p>
                                            <p><strong>Superficie agricole exploitable non exploit√©e :</strong> {rl0320A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Caract√©ristiques du b√¢timent principal -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üèóÔ∏è Groupe Caract√©ristiques du b√¢timent principal</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nombre maximal d'√©tages :</strong> {rl0306A}</p>
                                            <p><strong>Ann√©e construction originelle :</strong> {rl0307A}</p>
                                            <p><strong>Mention r√©elle/estim√©e :</strong> {rl0307B}</p>
                                            <p><strong>Aire d'√©tages :</strong> {rl0308A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Code lien physique :</strong> {rl0309A}</p>
                                            <p><strong>Code genre construction :</strong> {rl0310A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Informations d'occupation -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè† Groupe Informations d'occupation</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nombre total logements :</strong> {rl0311A}</p>
                                            <p><strong>Nombre chambres locatives :</strong> {rl0312A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nombre locaux non r√©sidentiels :</strong> {rl0313A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Services municipaux -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üîß Groupe Services municipaux</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nombre raccordements aqueduc :</strong> {rl0317A}</p>
                                            <p><strong>Nombre raccordements √©gout sanitaire :</strong> {rl0318A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nombre raccordements √©gout pluvial :</strong> {rl0319A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Section 4 : Valeurs au r√¥le d'√©valuation -->
                            <lightning-accordion-section name="values" label="üí∞ Section 4 : Valeurs au r√¥le d'√©valuation">
                                
                                <!-- Groupe Information de r√©f√©rence -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìÖ Groupe Information de r√©f√©rence</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Date de r√©f√©rence des conditions du march√© :</strong> {rl0401A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Valeurs au r√¥le en vigueur -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üíµ Groupe Valeurs au r√¥le en vigueur</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Valeur du terrain inscrite au r√¥le :</strong> {rl0402A}</p>
                                            <p><strong>Valeur du/des b√¢timents inscrite au r√¥le :</strong> {rl0403A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Valeur totale de l'immeuble inscrite au r√¥le :</strong> {rl0404A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Valeur comparative -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìä Groupe Valeur comparative</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Valeur du m√™me immeuble au r√¥le ant√©rieur :</strong> {rl0405A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Section 5 : R√©partition fiscale -->
                            <lightning-accordion-section name="exemptions" label="üèõÔ∏è Section 5 : R√©partition fiscale">
                                
                                <!-- Groupe Cat√©gories de base -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìã Groupe Cat√©gories de base</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Terrains vagues desservis :</strong> {rl0501A}</p>
                                            <p><strong>Classe immeubles non r√©sidentiels :</strong> {rl0502A}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Classe immeubles industriels :</strong> {rl0503A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Secteur -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üèòÔ∏è Groupe Secteur</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Code du secteur pour taxation :</strong> {rl0508A}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Sous-cat√©gories non r√©sidentielles -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè¢ Groupe Sous-cat√©gories non r√©sidentielles</h4>
                                    <template if:true={rl0506Ax.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Code">Code sous-cat√©gorie</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Proportion">Proportion (%)</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rl0506Ax} for:item="categorie" for:index="index">
                                                        <tr key={categorie.code}>
                                                            <td>{categorie.code}</td>
                                                            <td>{categorie.proportion}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rl0506Ax.length}>
                                        <p>Aucune sous-cat√©gorie non r√©sidentielle disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe Sous-cat√©gories r√©sidentielles -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè† Groupe Sous-cat√©gories r√©sidentielles</h4>
                                    <template if:true={rl0509Ax.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Code">Code sous-cat√©gorie</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Proportion">Proportion (%)</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rl0509Ax} for:item="categorie" for:index="index">
                                                        <tr key={categorie.code}>
                                                            <td>{categorie.code}</td>
                                                            <td>{categorie.proportion}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rl0509Ax.length}>
                                        <p>Aucune sous-cat√©gorie r√©sidentielle disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe R√©partitions l√©gales g√©n√©rales -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">‚öñÔ∏è Groupe R√©partitions l√©gales g√©n√©rales</h4>
                                    <template if:true={rl0504Ax.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Loi">Loi</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Article">Article</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Alin√©a">Alin√©a</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Montant">Montant</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Partie">Partie</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Imposabilit√©">Code imposabilit√©</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rl0504Ax} for:item="repartition" for:index="index">
                                                        <tr key={repartition.loi}>
                                                            <td>{repartition.loi}</td>
                                                            <td>{repartition.article}</td>
                                                            <td>{repartition.alinea}</td>
                                                            <td>{repartition.montant}</td>
                                                            <td>{repartition.partie}</td>
                                                            <td>{repartition.imposabilite}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rl0504Ax.length}>
                                        <p>Aucune r√©partition l√©gale g√©n√©rale disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe R√©partitions EAE scolaires -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üéì Groupe R√©partitions EAE scolaires</h4>
                                    <template if:true={rl0507Ax.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Loi">Loi EAE</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Article">Article EAE</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Alin√©a">Alin√©a EAE</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Montant">Montant EAE</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Partie">Partie EAE</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Imposabilit√©">Code imposabilit√© EAE</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rl0507Ax} for:item="repartition" for:index="index">
                                                        <tr key={repartition.loi}>
                                                            <td>{repartition.loi}</td>
                                                            <td>{repartition.article}</td>
                                                            <td>{repartition.alinea}</td>
                                                            <td>{repartition.montant}</td>
                                                            <td>{repartition.partie}</td>
                                                            <td>{repartition.imposabilite}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rl0507Ax.length}>
                                        <p>Aucune r√©partition EAE scolaire disponible</p>
                                    </template>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Section 6 : D√©claration de d√©p√¥t du r√¥le par l'√©valuateur -->
                            <lightning-accordion-section name="evaluator" label="üìù Section 6 : D√©claration de d√©p√¥t du r√¥le par l'√©valuateur">
                                
                                <!-- Groupe Identit√© de l'√©valuateur -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üë§ Groupe Identit√© de l'√©valuateur</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nom de l'√©valuateur signataire du r√¥le :</strong> {evaluatorName}</p>
                                            <p><strong>Pr√©nom de l'√©valuateur signataire du r√¥le :</strong> {evaluatorFirstName}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Titre de l'√©valuateur signataire du r√¥le :</strong> {evaluatorTitle}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Organisme et signature -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üèõÔ∏è Groupe Organisme et signature</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Nom de l'organisme municipal responsable du r√¥le d'√©valuation :</strong> {evaluatorOrganization}</p>
                                            <p><strong>Date de la signature par l'√©valuateur :</strong> {signatureDate}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Lieu de la signature par l'√©valuateur :</strong> {signatureLocation}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Informations annexables globales -->
                            <lightning-accordion-section name="global" label="üìä Informations annexables globales">
                                
                                <!-- Groupe M√©tadonn√©es globales -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üåê Groupe M√©tadonn√©es globales</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Version des informations :</strong> {rlzg0001}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Date de mise √† jour :</strong> {rlzg0002}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                            <!-- Informations annexables unit√© -->
                            <lightning-accordion-section name="unit" label="üè¢ Informations annexables unit√©">
                                
                                <!-- Groupe Identification unit√© -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üî¢ Groupe Identification unit√©</h4>
                                    <template if:true={rlzu1007x.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Num√©ro">Num√©ro d'unit√©</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Code">Code associ√©</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rlzu1007x} for:item="unite" for:index="index">
                                                        <tr key={unite.numero}>
                                                            <td>{unite.numero}</td>
                                                            <td>{unite.code}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rlzu1007x.length}>
                                        <p>Aucune identification d'unit√© disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe Superficie d√©taill√©e -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìê Groupe Superficie d√©taill√©e</h4>
                                    <template if:true={rlzu1008x.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Identifiant">Identificateur superficie</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Terrain">Superficie terrain</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="B√¢timent">Superficie b√¢timent</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Type">Type propri√©t√©</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rlzu1008x} for:item="superficie" for:index="index">
                                                        <tr key={superficie.identifiant}>
                                                            <td>{superficie.identifiant}</td>
                                                            <td>{superficie.superficieTerrain}</td>
                                                            <td>{superficie.superficieBatiment}</td>
                                                            <td>{superficie.typePropriete}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rlzu1008x.length}>
                                        <p>Aucune superficie d√©taill√©e disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe R√©f√©rences cadastrales -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üó∫Ô∏è Groupe R√©f√©rences cadastrales</h4>
                                    <template if:true={rlzu2001x.length}>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="R√©f√©rence">Num√©ro de r√©f√©rence</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Cadastral">Code cadastral</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Type">Type de r√©f√©rence</div>
                                                        </th>
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Statut">Statut cadastral</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rlzu2001x} for:item="cadastre" for:index="index">
                                                        <tr key={cadastre.numeroReference}>
                                                            <td>{cadastre.numeroReference}</td>
                                                            <td>{cadastre.codeCadastral}</td>
                                                            <td>{cadastre.typeReference}</td>
                                                            <td>{cadastre.statutCadastral}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:false={rlzu2001x.length}>
                                        <p>Aucune r√©f√©rence cadastrale disponible</p>
                                    </template>
                                </div>
                                
                                <!-- Groupe Mesures techniques -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìè Groupe Mesures techniques</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Mesure technique :</strong> {rlzu3001}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Classification -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üè∑Ô∏è Groupe Classification</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Classification principale :</strong> {rlzu3005A}</p>
                                            <p><strong>Sous-classification :</strong> {rlzu3005B}</p>
                                            <p><strong>Indicateur compl√©mentaire :</strong> {rlzu3005C}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Classification secondaire :</strong> {rlzu3006B}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Codes techniques sp√©cialis√©s -->
                                    <template if:true={rlzu3007x.length}>
                                        <p class="slds-m-top_small"><strong>Codes techniques sp√©cialis√©s :</strong></p>
                                        <div class="slds-table_container">
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="slds-text-title_caps" scope="col">
                                                            <div class="slds-truncate" title="Code">Code technique sp√©cialis√©</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={rlzu3007x} for:item="code" for:index="index">
                                                        <tr key={code.code}>
                                                            <td>{code.code}</td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                </div>
                                
                                <!-- Groupe Dates importantes -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üìÖ Groupe Dates importantes</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Date d'√©valuation :</strong> {rlzu3101}</p>
                                            <p><strong>Date d'entr√©e en vigueur :</strong> {rlzu3102}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Date de fin de validit√© :</strong> {rlzu3103}</p>
                                            <p><strong>Code de r√©f√©rence temporelle :</strong> {rlzu3104}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupe Valeurs financi√®res -->
                                <div class="slds-box slds-m-bottom_medium">
                                    <h4 class="slds-text-heading_small slds-m-bottom_small">üí∞ Groupe Valeurs financi√®res</h4>
                                    <div class="slds-grid slds-wrap slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Valeur terrain :</strong> {rlzu4001}</p>
                                            <p><strong>Valeur b√¢timent :</strong> {rlzu4002}</p>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <p><strong>Pourcentage de r√©partition :</strong> {rlzu5001}</p>
                                        </div>
                                    </div>
                                </div>
                                
                            </lightning-accordion-section>
                            
                        </lightning-accordion>
                    </div>
                </template>
                
                <!-- Aucun r√©sultat -->
                <template if:true={showNoResults}>
                    <div class="slds-box slds-theme_warning">
                        <h3 class="slds-text-heading_small">
                            ‚ùå Aucun r√©sultat
                        </h3>
                        <p>{noResultsMessage}</p>
                    </div>
                </template>
                
            </div>
            

            
        </div>
    </lightning-card>
</template> 